use Mojo::Base -strict;

use Test::More;
use Test::Mojo;

use File::Path;

#use a tmp dir for testing
my $games_dir = `mktemp -d`;
my $t = Test::Mojo->new(HotSeat => {
    games_dir => $games_dir,
});

#try to get lock status for a nonexistent game
$t->get_ok('/game/321/lock')
    ->status_is(404);

#create a new game and set a password
$t->post_ok('/game/321' => form => { user => "cam",
				     password => "goodpass" })
    ->status_is(200);


#try to get the game status without a password
$t->get_ok('/game/321' => form => { user => "cam"})
    ->status_is(401);

#same with the wrong password
$t->get_ok('/game/321' => form => { user => "cam",
				    password => "badpass"})
    ->status_is(403);

#same with the right password
$t->get_ok('/game/321' => form => { user => "cam",
				    password => "goodpass"})
    ->status_is(200)
    ->json_has('/owned_by')    
    ->json_is('/owned_by' => 'cam');

#try to get the game savestate file without a password

#same with a password

#try to get the game savestate file


#clean up tmp games_dir
rmtree($games_dir); 
done_testing();
